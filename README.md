# Bç«™è§†é¢‘ä¸‹è½½å™¨

ä¸€ä¸ªç”¨äº AstrBot çš„ Bç«™è§†é¢‘ä¸‹è½½æ’ä»¶ï¼Œé€šè¿‡è°ƒç”¨ [BBDown](https://github.com/nilaoda/BBDown) å‘½ä»¤è¡Œå·¥å…·æ¥ä¸‹è½½Bç«™è§†é¢‘ã€‚

## åŠŸèƒ½ç‰¹æ€§

- ğŸ¬ é€šè¿‡QQå‘½ä»¤ç›´æ¥ä¸‹è½½Bç«™è§†é¢‘
- ğŸª æ”¯æŒå¤šç§Cookieæ ¼å¼è‡ªåŠ¨è§£æ
- âš™ï¸ å¯é…ç½®çš„ä¸‹è½½é€‰é¡¹
- ğŸ“ è‡ªå®šä¹‰ä¸‹è½½è·¯å¾„
- ğŸ¯ æ”¯æŒé€‰æ‹©æ¸…æ™°åº¦ã€åˆ†Pç­‰é«˜çº§é€‰é¡¹
- ğŸ”— è‡ªåŠ¨ç”ŸæˆOpenListä¸‹è½½é“¾æ¥ï¼ˆæ”¯æŒå…¬å¼€ç›®å½•+å¯†ç ï¼‰
- ğŸ”— æ”¯æŒçŸ­é“¾æœåŠ¡é›†æˆï¼ˆè‡ªåŠ¨è½¬æ¢é•¿é“¾æ¥ä¸ºçŸ­é“¾ï¼‰
- ğŸ” çµæ´»çš„æƒé™æ§åˆ¶ï¼ˆæ”¯æŒç¾¤çº§å’Œç”¨æˆ·çº§æƒé™ç®¡ç†ï¼‰

## å®‰è£…è¦æ±‚

1. å®‰è£… [BBDown](https://github.com/nilaoda/BBDown) å¹¶ç¡®ä¿ `BBDown` å‘½ä»¤åœ¨ç³»ç»ŸPATHä¸­å¯ç”¨
2. ç¡®ä¿ AstrBot å·²æ­£ç¡®å®‰è£…å¹¶è¿è¡Œ

## ä½¿ç”¨æ–¹æ³•

### æŸ¥çœ‹å¸®åŠ©

```
/bili-help
```

æ˜¾ç¤ºæ‰€æœ‰å¯ç”¨å‘½ä»¤å’Œå¸®åŠ©ä¿¡æ¯ã€‚

### åŸºæœ¬ä¸‹è½½

```
/bili <è§†é¢‘URL>
```

ç¤ºä¾‹ï¼š
```
/bili https://www.bilibili.com/video/BV1qt4y1X7TW
```

### è®¾ç½®Cookie

ä¸ºäº†ä¸‹è½½éœ€è¦ç™»å½•çš„è§†é¢‘ï¼Œéœ€è¦è®¾ç½®Cookieï¼š

```
/bili-cookie <cookieå­—ç¬¦ä¸²>
```

### æµ‹è¯•Cookie

æµ‹è¯•Cookieæ˜¯å¦æœ‰æ•ˆï¼š

```
/bili-test-cookie [cookieå­—ç¬¦ä¸²]
```

å¦‚æœä¸æä¾›cookieå‚æ•°ï¼Œåˆ™æµ‹è¯•å½“å‰é…ç½®çš„cookieã€‚æµ‹è¯•æˆåŠŸåä¼šæ˜¾ç¤ºç”¨æˆ·ä¿¡æ¯ã€‚

Cookieæ”¯æŒå¤šç§æ ¼å¼ï¼Œç¨‹åºä¼šè‡ªåŠ¨è¯†åˆ«ï¼š

1. **æµè§ˆå™¨æ ¼å¼**ï¼ˆæ¨èï¼‰ï¼š
   ```
   SESSDATA=xxx; DedeUserID=xxx; bili_jct=xxx
   ```

2. **Netscapeæ ¼å¼**ï¼š
   ä»æµè§ˆå™¨å¯¼å‡ºçš„cookieæ–‡ä»¶æ ¼å¼

3. **JSONæ ¼å¼**ï¼š
   ```json
   {"SESSDATA": "xxx", "DedeUserID": "xxx"}
   ```

4. **çº¯æ–‡æœ¬æ ¼å¼**ï¼š
   ```
   SESSDATA=xxx
   DedeUserID=xxx
   ```

### è®¾ç½®é…ç½®

é€šè¿‡å‘½ä»¤è®¾ç½®å„ç§é…ç½®é¡¹ï¼š

```
/bili-set <é…ç½®é¡¹> <å€¼>
```

å¯ç”¨é…ç½®é¡¹ï¼š
- `bbdown_path` - BBDownå¯æ‰§è¡Œæ–‡ä»¶è·¯å¾„
- `download_path` - ä¸‹è½½ä¿å­˜è·¯å¾„
- `quality` - é»˜è®¤æ¸…æ™°åº¦ï¼ˆ8K/4K/1080P60/1080P/720P60/720P/480P/360Pï¼Œç•™ç©ºè¡¨ç¤ºè‡ªåŠ¨ï¼‰
- `danmaku` - æ˜¯å¦ä¸‹è½½å¼¹å¹•ï¼ˆtrue/false æˆ– æ˜¯/å¦ï¼‰
- `subtitle` - æ˜¯å¦ä¸‹è½½å­—å¹•ï¼ˆtrue/false æˆ– æ˜¯/å¦ï¼‰
- `single_pattern` - å•ä¸ªè§†é¢‘å‘½åæ ¼å¼
- `multi_pattern` - åˆ†Pè§†é¢‘å‘½åæ ¼å¼

ç¤ºä¾‹ï¼š
```
/bili-set download_path ./videos
/bili-set quality 1080P
/bili-set danmaku true
/bili-set single_pattern <è§†é¢‘æ ‡é¢˜>[<æ¸…æ™°åº¦>]
```

### æŸ¥çœ‹é…ç½®

```
/bili-config
```

### æŸ¥çœ‹å‘½åæ ¼å¼å‚æ•°

```
/bili-naming
```

æŸ¥çœ‹æ‰€æœ‰å¯ç”¨çš„æ–‡ä»¶å‘½åæ ¼å¼å‚æ•°ï¼Œç”¨äºè‡ªå®šä¹‰æ–‡ä»¶å‘½åã€‚

## é…ç½®è¯´æ˜

é…ç½®æ–‡ä»¶ä½äº `data/config/bilidownloader_config.json`ï¼Œä¹Ÿå¯ä»¥é€šè¿‡WebUIè¿›è¡Œé…ç½®ã€‚

### åŸºç¡€é…ç½®

```json
{
  "bbdown_path": "BBDown",
  "download_path": "./downloads",
  "cookie": "",
  "default_options": {
    "quality": "",
    "download_danmaku": false,
    "download_subtitle": true
  }
}
```

### é…ç½®é¡¹è¯´æ˜

- `bbdown_path`: BBDownå¯æ‰§è¡Œæ–‡ä»¶çš„è·¯å¾„ï¼Œå¦‚æœBBDownåœ¨PATHä¸­ï¼Œç›´æ¥å†™ "BBDown" å³å¯
- `download_path`: è§†é¢‘ä¸‹è½½ä¿å­˜è·¯å¾„
- `cookie`: é»˜è®¤ä½¿ç”¨çš„Cookieï¼ˆå¯é€šè¿‡å‘½ä»¤è®¾ç½®ï¼‰
- `default_options`: é»˜è®¤ä¸‹è½½é€‰é¡¹
  - `quality`: é»˜è®¤æ¸…æ™°åº¦ï¼ˆç©ºè¡¨ç¤ºä¸æŒ‡å®šï¼‰
  - `download_danmaku`: æ˜¯å¦ä¸‹è½½å¼¹å¹•
  - `download_subtitle`: æ˜¯å¦ä¸‹è½½å­—å¹•
- `naming`: æ–‡ä»¶å‘½åæ ¼å¼é…ç½®
  - `single_video_pattern`: å•ä¸ªè§†é¢‘æ–‡ä»¶å‘½åæ ¼å¼ï¼ˆé»˜è®¤ï¼š`<videoTitle>[<dfn>]`ï¼‰
  - `multi_video_pattern`: åˆ†Pè§†é¢‘æ–‡ä»¶å‘½åæ ¼å¼ï¼ˆé»˜è®¤ï¼š`<videoTitle>/[P<pageNumberWithZero>]<pageTitle>[<dfn>]`ï¼‰
  
  ä½¿ç”¨ `/bili-naming` å‘½ä»¤æŸ¥çœ‹æ‰€æœ‰å¯ç”¨å‚æ•°ã€‚

### OpenList é“¾æ¥ç”Ÿæˆé…ç½®

ä¸‹è½½å®Œæˆåè‡ªåŠ¨ç”ŸæˆOpenListä¸‹è½½é“¾æ¥ï¼ˆå¯é€‰ï¼‰ï¼š

```json
{
  "alist": {
    "enabled": true,
    "base_url": "http://your-openlist.com:5244",
    "password": "your-folder-password",
    "alist_storage_path": "/bilibili"
  }
}
```

- `enabled`: æ˜¯å¦å¯ç”¨OpenListé“¾æ¥ç”Ÿæˆ
- `base_url`: OpenListè®¿é—®åœ°å€
- `password`: æ–‡ä»¶å¤¹å¯†ç ï¼ˆå…¬å¼€ç›®å½•+å¯†ç åœºæ™¯ï¼Œæ— éœ€tokenï¼‰
- `alist_storage_path`: æ–‡ä»¶åœ¨OpenListä¸­çš„å­˜å‚¨è·¯å¾„

### çŸ­é“¾æœåŠ¡é…ç½®

æ”¯æŒå°†ç”Ÿæˆçš„é“¾æ¥è½¬æ¢ä¸ºçŸ­é“¾ï¼ˆå¯é€‰ï¼‰ï¼š

```json
{
  "alist": {
    "shortener": {
      "enabled": true,
      "api_url": "https://shortlinks.sube.top/api/shorten",
      "method": "POST",
      "data_key": "url",
      "api_key": "your-api-key",
      "auth_method": "header",
      "auth_header": "X-API-Key"
    }
  }
}
```

æ”¯æŒçš„å¼€æºçŸ­é“¾æœåŠ¡ï¼š
- [ShortLinks](https://github.com/Sube3494/shortlinks) - FastAPIçŸ­é“¾æœåŠ¡
- [YOURLS](https://yourls.org/) - PHPçŸ­é“¾æœåŠ¡
- [Polr](https://github.com/cydrobolt/polr) - PHPçŸ­é“¾æœåŠ¡
- [Kutt](https://github.com/thedevs-network/kutt) - Node.jsçŸ­é“¾æœåŠ¡
- [Shlink](https://shlink.io/) - PHPçŸ­é“¾æœåŠ¡

### æƒé™æ§åˆ¶é…ç½®

æ”¯æŒçµæ´»çš„æƒé™ç®¡ç†ï¼Œå¯ä»¥è®¾ç½®å“ªäº›ç¾¤æˆ–ç”¨æˆ·å¯ä»¥ä½¿ç”¨ä¸‹è½½åŠŸèƒ½ï¼š

```json
{
  "alist": {
    "permissions": {
      "open_groups": ["123456789", "987654321"],
      "restricted_groups": {
        "111222333": ["user1", "user2"],
        "444555666": ["user3"]
      }
    }
  }
}
```

- `open_groups`: å¼€æ”¾ç¾¤ç»„åˆ—è¡¨ï¼ˆç¾¤å†…æ‰€æœ‰äººå¯ç”¨ï¼‰ï¼ŒQQå¹³å°ä¸ºQQç¾¤å·åˆ—è¡¨
- `restricted_groups`: å—é™ç¾¤ç»„é…ç½®ï¼ˆç¾¤å†…éƒ¨åˆ†äººå¯ç”¨ï¼‰
  - é”®åï¼šç¾¤å·ï¼ˆQQå¹³å°ä¸ºQQç¾¤å·ï¼‰
  - å€¼ï¼šè¯¥ç¾¤å†…å…è®¸ä½¿ç”¨çš„QQå·åˆ—è¡¨

ä½¿ç”¨ `/sid` å‘½ä»¤å¯ä»¥è·å–ç¾¤å·å’ŒQQå·ã€‚

## å‘½ä»¤åˆ—è¡¨

### ä¸‹è½½ç›¸å…³
- `/bili` - ä¸‹è½½Bç«™è§†é¢‘ï¼ˆåˆ«åï¼š`/bilibili`, `/bç«™`, `/Bç«™`ï¼‰

### é…ç½®ç›¸å…³
- `/bili-set` - è®¾ç½®æ’ä»¶é…ç½®ï¼ˆåˆ«åï¼š`/bilibili-set`, `/bç«™è®¾ç½®`, `/Bç«™è®¾ç½®`ï¼‰
- `/bili-config` - æŸ¥çœ‹å½“å‰é…ç½®ï¼ˆåˆ«åï¼š`/bilibili-config`, `/bç«™é…ç½®`, `/Bç«™é…ç½®`ï¼‰

### Cookieç›¸å…³
- `/bili-cookie` - è®¾ç½®Bç«™Cookieï¼ˆåˆ«åï¼š`/bilibili-cookie`, `/bç«™cookie`, `/Bç«™cookie`ï¼‰
- `/bili-test-cookie` - æµ‹è¯•Cookieæ˜¯å¦æœ‰æ•ˆï¼ˆåˆ«åï¼š`/bilibili-test-cookie`, `/bç«™æµ‹è¯•cookie`, `/Bç«™æµ‹è¯•cookie`, `/æµ‹è¯•cookie`ï¼‰

### å‘½åæ ¼å¼ç›¸å…³
- `/bili-naming` - æŸ¥çœ‹æ–‡ä»¶å‘½åæ ¼å¼å¯ç”¨å‚æ•°ï¼ˆåˆ«åï¼š`/bilibili-naming`, `/bç«™å‘½å`, `/Bç«™å‘½å`ï¼‰

### å¸®åŠ©
- `/bili-help` - æ˜¾ç¤ºæ‰€æœ‰å¯ç”¨å‘½ä»¤å’Œå¸®åŠ©ä¿¡æ¯ï¼ˆåˆ«åï¼š`/bilibili-help`, `/bç«™å¸®åŠ©`, `/Bç«™å¸®åŠ©`, `/biliå¸®åŠ©`ï¼‰

ğŸ’¡ æç¤ºï¼šä½¿ç”¨ `/bili-help` å¯ä»¥æŸ¥çœ‹æ‰€æœ‰å‘½ä»¤çš„è¯¦ç»†è¯´æ˜

## é«˜çº§åŠŸèƒ½

### OpenList é“¾æ¥ç”Ÿæˆ

ä¸‹è½½å®Œæˆåï¼Œå¦‚æœå¯ç”¨äº†OpenListé…ç½®ï¼Œæ’ä»¶ä¼šè‡ªåŠ¨ï¼š
1. æ‰«æä¸‹è½½ç›®å½•ï¼ŒåŒ¹é…å·²ä¸‹è½½çš„è§†é¢‘æ–‡ä»¶
2. æ ¹æ®é…ç½®çš„å­˜å‚¨è·¯å¾„ï¼Œæ„å»ºæ–‡ä»¶åœ¨OpenListä¸­çš„è·¯å¾„
3. è°ƒç”¨OpenList APIè·å–æ–‡ä»¶ç›´é“¾
4. å¦‚æœé…ç½®äº†çŸ­é“¾æœåŠ¡ï¼Œè‡ªåŠ¨è½¬æ¢ä¸ºçŸ­é“¾
5. åœ¨ä¸‹è½½å®Œæˆæ¶ˆæ¯ä¸­æ˜¾ç¤ºä¸‹è½½é“¾æ¥

### æƒé™æ§åˆ¶

æ’ä»¶æ”¯æŒä¸¤ç§æƒé™æ¨¡å¼ï¼š

1. **å¼€æ”¾ç¾¤ç»„**ï¼šç¾¤å·åœ¨ `open_groups` åˆ—è¡¨ä¸­ï¼Œè¯¥ç¾¤æ‰€æœ‰æˆå‘˜éƒ½å¯ä»¥ä½¿ç”¨
2. **å—é™ç¾¤ç»„**ï¼šç¾¤å·åœ¨ `restricted_groups` ä¸­ï¼Œåªæœ‰é…ç½®çš„ç”¨æˆ·å¯ä»¥ä½¿ç”¨

å¦‚æœä¸¤ä¸ªåˆ—è¡¨éƒ½ä¸ºç©ºï¼Œé»˜è®¤å…è®¸æ‰€æœ‰äººä½¿ç”¨ï¼ˆå‘åå…¼å®¹ï¼‰ã€‚

### çŸ­é“¾è½¬æ¢

æ”¯æŒå¤šç§çŸ­é“¾æœåŠ¡ï¼Œä¸‹è½½å®Œæˆåè‡ªåŠ¨å°†OpenListé“¾æ¥è½¬æ¢ä¸ºçŸ­é“¾ï¼Œæ–¹ä¾¿åˆ†äº«ã€‚

## æ³¨æ„äº‹é¡¹

1. é¦–æ¬¡ä½¿ç”¨å‰è¯·ç¡®ä¿å·²å®‰è£…BBDown
2. ä¸‹è½½éœ€è¦ç™»å½•çš„è§†é¢‘æ—¶ï¼Œè¯·å…ˆè®¾ç½®Cookie
3. Cookieä¼šä¿å­˜åœ¨é…ç½®æ–‡ä»¶ä¸­ï¼Œè¯·æ³¨æ„å®‰å…¨
4. ä¸‹è½½å¤§æ–‡ä»¶å¯èƒ½éœ€è¦è¾ƒé•¿æ—¶é—´ï¼Œè¯·è€å¿ƒç­‰å¾…
5. OpenListé“¾æ¥ç”Ÿæˆéœ€è¦æ–‡ä»¶å·²å®Œå…¨ä¸‹è½½å®Œæˆ
6. æƒé™é…ç½®ä¸­çš„ç¾¤å·å’ŒQQå·å¯é€šè¿‡ `/sid` å‘½ä»¤è·å–

## ç›¸å…³é“¾æ¥

- [BBDowné¡¹ç›®åœ°å€](https://github.com/nilaoda/BBDown)
- [AstrBotæ–‡æ¡£](https://astrbot.app)
